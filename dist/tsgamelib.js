
var Animation=function(){function t(t,e,i,h,s,r,a){this.looped=0,this.frames=t,this.frame=s,this.width=i,this.height=h,this.frameXStart=s,this.frameYStart=r,this.maxFrames=e,this.timer=(new Date).getTime(),this.looped=0,null!=a?this.speed=a:this.speed=200}return t.prototype.update=function(){(new Date).getTime()>this.timer+this.speed&&(this.frame++,this.frame>this.maxFrames&&(this.frame=this.frameXStart,this.looped++),this.timer=(new Date).getTime())},t.prototype.render=function(t,e,i,h,s){t.drawImage(this.frames,this.width*this.frame,this.frameYStart*this.height,this.width,this.height,e,i,h,s)},t.prototype.reset=function(){this.looped=0,this.frame=this.frameXStart},t}();
var ImageManager=function(){function s(s){this.urls=s}return s.prototype.load=function(s){var t=this,i=0;for(var n in this.urls)this.images[n]=new Image,this.images[n].onload=function(){i++,i==Object.keys(t.urls).length&&s()},this.images[n].src=this.urls[n]},s}();
var SoundEffect=function(){function t(t){this.instances=[],this._volume=1,this._muted=!1,this.src=t}return Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){this._volume=t,this.applyToAllInstances(function(n){n.volume=t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.applyToAllInstances(function(n){n.muted=t})},enumerable:!0,configurable:!0}),t.prototype.play=function(){var t=this.instances.length-1;this.instances.push(new Audio(this.src)),this.instances[t+1].volume=this._volume,this.instances[t+1].muted=this._muted,this.instances[t+1].play();var n=this;this.instances[t+1].onended=function(){n.instances.splice(t+1,1)}},t.prototype.applyToAllInstances=function(t){if(this.instances.length>0)for(var n=0;n<this.instances.length;n++)t(this.instances[n])},t}();
var SoundManager=function(){function t(){this.soundEffects=[],this.soundtracks=[]}return t.prototype.add=function(t){t instanceof SoundEffect?this.soundEffects.push(t):t instanceof Soundtrack&&this.soundtracks.push(t)},t.prototype.remove=function(t){t instanceof SoundEffect?this.soundEffects.splice(this.soundEffects.indexOf(t),1):t instanceof Soundtrack&&this.soundtracks.splice(this.soundtracks.indexOf(t),1)},t.prototype.setVolumeAll=function(t){this.setVolumeSoundEffects(t),this.setVolumeSoundEffects(t)},t.prototype.setVolumeSoundEffects=function(t){this.applyToArray(this.soundEffects,function(o){o.volume=t})},t.prototype.setVolumeSoundtracks=function(t){this.applyToArray(this.soundtracks,function(o){o.volume=t})},t.prototype.setMutedAll=function(t){this.setMutedSoundEffects(t),this.setMutedSoundtracks(t)},t.prototype.setMutedSoundEffects=function(t){this.applyToArray(this.soundEffects,function(o){o.muted=t})},t.prototype.setMutedSoundtracks=function(t){this.applyToArray(this.soundtracks,function(o){o.muted=t})},t.prototype.applyToArray=function(t,o){if(t.length>0)for(var s=0;s<t.length;s++)o(t[s])},t}();
var Soundtrack=function(){function t(t){this.track=new Audio(t),this.track.onended=function(){this.currentTime=0,this.play()}}return Object.defineProperty(t.prototype,"volume",{get:function(){return this.track.volume},set:function(t){this.track.volume=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this.track.muted},set:function(t){this.track.muted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this.track.src},set:function(t){this.track.src=t},enumerable:!0,configurable:!0}),t.prototype.play=function(){this.track.play()},t.prototype.pause=function(){this.track.pause()},t}();
var Map=function(){function t(t,i,e,h,a){this.tileSheet=t,this.tileSize=i,this.mapSize=e,this.tileData=h,this.mapData=a}return t.prototype.render=function(t,i,e){for(var h=Utils.getCanvasSize(),a=this.tileSize.width,s=this.tileSize.height,r=0;r<this.mapSize.width;r++)for(var n=0;n<this.mapSize.height;n++)if(!(i-a>r*a||r*a>i+h.width+a||e-s>n*s||n*s>e+h.height+s)){var S=this.tileData[this.mapData[n][r]];t.drawImage(this.tileSheet,S.x*a,S.y*s,a,s,r*a-i,n*s-e,a,s)}},t}();
var Point=function(){function t(t,i){this.x=t,this.y=i}return t.prototype.add=function(i,n){i instanceof t&&null==n?(this.addX(i.x),this.addY(i.y)):i instanceof Size&&null==n?(this.addX(i.width),this.addY(i.height)):"number"==typeof i&&"number"==typeof n&&(this.addX(i),this.addY(n))},t.prototype.addX=function(t){this.x+=t},t.prototype.addY=function(t){this.y+=t},t}();
var Size=function(){function i(i,t){this.width=i,this.height=t}return i}();
var FontBase=function(){function t(t,n,i,o){this.font=t,this.fontSize=n,this.fontColour=i,this.textAlign=o}return t.prototype.applyFontSettings=function(t){t.font=this.fontSize+"px "+this.font,t.fillStyle=this.fontColour,t.textAlign=this.textAlign},t}();
var Menu=function(){function t(t,e){this.title=t,this.options=e}return t.prototype.changeOption=function(t){this.options.changeOption(t)},t.prototype.executeAction=function(){this.options.executeAction()},t.prototype.render=function(t){var e=Utils.getCanvasCenter(),i=this.getHeightPositions(this.options.text.length+1);this.title.render(t,e.x,i[0]),i.splice(0,1),this.options.render(t,e.x,i)},t.prototype.getHeightPositions=function(t){for(var e=Utils.getCanvasSize(),i=e.height/t,n=[],o=0;t>o;o++)n.push(i*o+i/2);return n},t}();
var MenuManager=function(){function e(e,t){this._keycodes={wasd:{up:87,down:83,left:65,right:68},arrows:{up:38,down:40,left:37,right:39},enter:13,space:32,backspace:8,shift:16,escape:27},this._menus=e,this._keyType=t.keyType,this._menuIndex=0}return e.prototype.changeMenu=function(e){this._menuIndex=e},e.prototype.render=function(e){var t=this._menus[this._menuIndex];t.render(e)},e.prototype.changeSelectedText=function(e){this._menus[this._menuIndex]._selectedText=e},e.prototype.onKeyPress=function(e){var t=this._menus[this._menuIndex];switch(e.keyCode){case this._keycodes[this._keyType].up:t.changeOption(!1);break;case this._keycodes[this._keyType].down:t.changeOption(!0);break;case this._keycodes[this._keyType].left:break;case this._keycodes[this._keyType].right:break;case this._keycodes.enter:t.executeAction()}},e}();
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MenuOptions=function(t){function e(e,i,n,o,s,p){t.call(this,e,i,n,o),this.text=s,this.actions=p,this.selectedOption=0}return __extends(e,t),e.prototype.executeAction=function(){this.actions[this.selectedOption]()},e.prototype.changeOption=function(t){t?(this.selectedOption++,this.selectedOption>=this.text.length&&(this.selectedOption=0)):(this.selectedOption--,this.selectedOption<0&&(this.selectedOption=this.text.length-1))},e.prototype.render=function(e,i,n){t.prototype.applyFontSettings.call(this,e);for(var o=0;o<this.text.length;o++){var s="";s+=this.selectedOption===o?"< "+this.text[o]+" >":this.text[o],e.fillText(s,i,n[o])}},e}(FontBase);
var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},MenuTitle=function(t){function e(e,n,o,r,i){t.call(this,e,n,o,r),this.text=i}return __extends(e,t),e.prototype.render=function(e,n,o){t.prototype.applyFontSettings.call(this,e),e.fillText(this.text,n,o)},e}(FontBase);
var Utils=function(){function t(){}return t.getCanvas=function(){return document.getElementById("canvas")},t.getCanvasSize=function(){return{width:this.getCanvas().clientWidth,height:this.getCanvas().clientHeight}},t.getCanvasCenter=function(){return{x:this.getCanvas().clientWidth/2,y:this.getCanvas().clientHeight/2}},t}();
var Circle=function(){function t(t,i){this.pos=t,this.radius=i}return t.prototype.center=function(){return new Point(this.pos.x+this.radius,this.pos.y+this.radius)},t.prototype.collides=function(i,n){return i instanceof Rectangle?i.collides(this):i instanceof t?this.collision(i.center().x,i.center().y,i.radius):i instanceof Point&&null!=n?this.collision(i.x+n,i.y+n,n):i instanceof Point?this.collision(i.x,i.y):void 0},t.prototype.collision=function(t,i,n){var o=this.radius,s=null!=n?n:0,e=this.center().x-t;e*=e;var r=this.center().y-i;r*=r;var c=Math.sqrt(e+r);return o+s>c},t}();
var Rectangle=function(){function i(i,t,s,e){i instanceof Point&&t instanceof Size?(this.pos=i,this.size=t):"number"==typeof i&&"number"==typeof t&&(this.pos=new Point(i,t),this.size=new Size(s,e))}return i.prototype.center=function(){var i=this.pos.x+this.size.width/2,t=this.pos.y+this.size.height/2;return new Point(i,t)},i.prototype.points=function(){var i=new Point(this.pos.x+this.size.width,this.pos.y),t=new Point(this.pos.x+this.size.width,this.pos.y+this.size.height),s=new Point(this.pos.x,this.pos.y+this.size.height);return[this.pos,i,t,s]},i.prototype.collides=function(t,s){return t instanceof Circle?this.circleAndRectCollision(t):t instanceof i?this.collision(t.pos.x,t.pos.y,t.size.width,t.size.height):t instanceof Point?null!=s?this.collision(t.x,t.y,s.width,s.height):this.collision(t.x,t.y,0,0):void 0},i.prototype.collision=function(i,t,s,e){return i+s>=this.pos.x&&i<=this.pos.x+this.size.width&&t+e>=this.pos.y&&t<=this.pos.y+this.size.height},i.prototype.circleAndRectCollision=function(i){var t=Math.abs(i.center().x-this.center().x),s=Math.abs(i.center().y-this.center().y);if(t>this.size.width/2+i.radius)return!1;if(s>this.size.height/2+i.radius)return!1;if(t<=this.size.width/2)return!0;if(s<=this.size.height/2)return!0;var e=Math.pow(t-this.size.width/2,2)+Math.pow(s-this.size.height/2,2);return e<=Math.pow(i.radius,2)},i}();